(function(d,k){var h,l=d.mobile.popup.handleLink;d.mobile.popup.handleLink=function(a){h=a;return l.apply(this,arguments)};d.widget("mobile.popup",d.mobile.popup,{options:{align:"0.5,0.5"},open:function(a){this._ui.link=h;return this._super(a)},_closePrereqsDone:function(){this._ui.link=null;this._superApply(arguments)},_alignmentToCoeffs:function(a){return{originCoeff:0>a?0:1>=a?a:1,popupCoeff:0>a?a:1>=a?-a:a-2}},_getAlignment:function(){var a,b;this.options.align&&(a=this.options.align.split(","));
a&&0<a.length&&(b={x:parseFloat(a[0]),y:1<a.length?parseFloat(a[1]):b.x});if(b&&!isNaN(b.x)&&!isNaN(b.y))return{x:this._alignmentToCoeffs(b.x),y:this._alignmentToCoeffs(b.y)}},_setOptions:function(a){var b,c;this._super(a);!this._isOpen||a.align===k||null===this._ui.link||"origin"!==this._ui.link.jqmData("position-to")&&"origin"!==this.options.positionTo||(c=this._ui.link.offset(),a=this._ui.link.outerWidth(),b=this._ui.link.outerHeight(),this._reposition({x:c.left+a/2,y:c.top+b/2,positionTo:"origin"}))},
_alignedCoord:function(a,b,c,f){return a+b.originCoeff*c+b.popupCoeff*f+f/2},_desiredCoords:function(a){var b,c,f,d,e,g=this._getAlignment();g&&"origin"===a.positionTo&&this._ui.link&&(e=this._clampPopupWidth(!0),e.menuSize.cx=Math.min(e.menuSize.cx,e.rc.cx),c=this._ui.link.offset(),b=c.left,c=c.top,f=this._ui.link.outerWidth(),d=this._ui.link.outerHeight(),a.x=this._alignedCoord(b,g.x,f,e.menuSize.cx),a.y=this._alignedCoord(c,g.y,d,e.menuSize.cy));return this._super(a)}})})(jQuery);

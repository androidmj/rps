var APG={positionArray:[],VIDEO_COLUMNS:100,VIDEO_ROWS:50,ANIMATION_INTERVAL_MS:42,MAX_TIME_DIFFERENCE:.25};APG.positionArray[0]=0;APG.demoRow=null;APG.demoColumn=null;APG.demoBoxTimeout=null;APG.savePositionTimeoutId=null;APG.videoTimestamp=null;APG.divPos={};
$(document).ready(function(){APG.$videoSource=$("#video-source");APG.$videoWrapper=$("#video-wrapper");APG.$demoBox=$(".demo-box");APG.video=document.getElementById("video-source");setDynamicConstants();$(window).on("resize",function(){setDynamicConstants()});APG.$demoBox.css({height:APG.rowHelper+"px",width:APG.columnHelper+"px"});APG.$videoWrapper.mousemove(function(a){APG.divPos={left:a.pageX-APG.videoOffsetLeft,top:a.pageY-APG.videoOffsetTop}});APG.$videoWrapper.on("mouseenter",function(a){startAnimation()}).on("mouseleave",
function(a){stopAnimation()});setInterval(function(){APG.videoTimestamp=APG.video.currentTime},42);APG.$videoWrapper.on("mousedown",function(a){if(2==a.button)return setRowAndColumn(),showDemoBox(a),console.log(APG.divPos),console.log("column "+APG.demoColumn),console.log("row "+APG.demoRow),!1;APG.savePositionTimeoutId=setInterval(function(){savePosition()},10)}).on("mouseup mouseleave",function(){clearInterval(APG.savePositionTimeoutId)});APG.$videoWrapper.on("contextmenu",function(){return!1});
$("#button").on("click",hideAndShow);console.log(APG.videoOffsetTop);setTimeout(function(){$(window).trigger("resize");console.log(APG.videoOffsetTop)},1E3)});function setRowAndColumn(){APG.demoColumn=Math.ceil(APG.divPos.left/APG.columnHelper);APG.demoColumn=limitBetweenMinMax(APG.demoColumn,1,APG.VIDEO_COLUMNS);APG.demoRow=Math.ceil(APG.divPos.top/APG.rowHelper);APG.demoRow=limitBetweenMinMax(APG.demoRow,1,APG.VIDEO_ROWS)}
function limitBetweenMinMax(a,c,b){return Math.min(Math.max(parseInt(a),c),b)}function showDemoBox(){clearTimeout(APG.demoBoxTimeout);APG.$demoBox.css({top:APG.videoOffsetTop+(APG.demoRow-1)*APG.rowHelper+"px",left:APG.videoOffsetLeft+(APG.demoColumn-1)*APG.columnHelper+"px"});APG.demoBoxTimeout=setTimeout(function(){APG.$demoBox.css({top:"-100px"})},500)}
function savePosition(){setRowAndColumn();showDemoBox();APG.positionArray[Math.round(APG.ANIMATION_INTERVAL_MS*APG.videoTimestamp)]={column:APG.demoColumn,row:APG.demoRow,time:APG.videoTimestamp};console.log(APG.positionArray[Math.round(APG.ANIMATION_INTERVAL_MS*APG.videoTimestamp)].time)}
function changePosition(){var a=getClosestKey(Object.keys(APG.positionArray),Math.round(APG.ANIMATION_INTERVAL_MS*APG.videoTimestamp));APG.demoColumn=APG.positionArray[a].column;APG.demoRow=APG.positionArray[a].row;Math.abs(APG.positionArray[a].time-APG.videoTimestamp)<APG.MAX_TIME_DIFFERENCE&&showDemoBox()}function getClosestKey(a,c){for(var b,d=a.length-1,e=0,f;e<=d;)if(b=(e+d)/2|0,f=a[b],f<c)e=b+1;else if(f>c)d=b-1;else break;return a[b]}
function startAnimation(){timeAnimateId=setInterval(function(){changePosition()},APG.ANIMATION_INTERVAL_MS)}function stopAnimation(){clearInterval(timeAnimateId)}function hideAndShow(){APG.$videoSource.toggleClass("hide")}
function setDynamicConstants(){APG.demoBoxHeight=APG.$demoBox.height();APG.demoBoxWidth=APG.$demoBox.width();APG.offset=APG.$videoSource.offset();APG.videoOffsetTop=APG.offset.top;APG.videoOffsetLeft=APG.offset.left;APG.videoWrapperHeight=APG.$videoWrapper.height();APG.videoWrapperWidth=APG.$videoWrapper.width();APG.columnHelper=APG.videoWrapperWidth/APG.VIDEO_COLUMNS;APG.rowHelper=APG.videoWrapperHeight/APG.VIDEO_ROWS};

(function(g){var m=g.each,r=function(b,a){this.init(b,a)};g.extend(r.prototype,{init:function(b,a){this.options=b;this.chartOptions=a;this.columns=b.columns||this.rowsToColumns(b.rows)||[];this.columns.length?this.dataFound():(this.parseCSV(),this.parseTable(),this.parseGoogleSpreadsheet())},getColumnDistribution:function(){var b=this.chartOptions,a=b&&b.chart&&b.chart.type,c=[];m(b&&b.series||[],function(b){c.push((g.seriesTypes[b.type||a||"line"].prototype.pointArrayMap||[0]).length)});this.valueCount=
{global:(g.seriesTypes[a||"line"].prototype.pointArrayMap||[0]).length,individual:c}},dataFound:function(){this.parseTypes();this.findHeaderRow();this.parsed();this.complete()},parseCSV:function(){var b=this,a=this.options,c=a.csv,e=this.columns,d=a.startRow||0,f=a.endRow||Number.MAX_VALUE,l=a.startColumn||0,q=a.endColumn||Number.MAX_VALUE,n,h,g=0;c&&(h=c.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split(a.lineDelimiter||"\n"),n=a.itemDelimiter||(-1!==c.indexOf("\t")?"\t":","),m(h,function(a,c){var h=
b.trim(a),k=0===h.indexOf("#");c>=d&&c<=f&&!k&&""!==h&&(h=a.split(n),m(h,function(b,a){a>=l&&a<=q&&(e[a-l]||(e[a-l]=[]),e[a-l][g]=b)}),g+=1)}),this.dataFound())},parseTable:function(){var b=this.options,a=b.table,c=this.columns,e=b.startRow||0,d=b.endRow||Number.MAX_VALUE,f=b.startColumn||0,l=b.endColumn||Number.MAX_VALUE,g;a&&("string"===typeof a&&(a=document.getElementById(a)),m(a.getElementsByTagName("tr"),function(a,b){g=0;b>=e&&b<=d&&m(a.childNodes,function(a){("TD"===a.tagName||"TH"===a.tagName)&&
g>=f&&g<=l&&(c[g]||(c[g]=[]),c[g][b-e]=a.innerHTML,g+=1)})}),this.dataFound())},parseGoogleSpreadsheet:function(){var b=this,a=this.options,c=a.googleSpreadsheetKey,e=this.columns,d=a.startRow||0,f=a.endRow||Number.MAX_VALUE,g=a.startColumn||0,m=a.endColumn||Number.MAX_VALUE,n,h;c&&jQuery.getJSON("https://spreadsheets.google.com/feeds/cells/"+c+"/"+(a.googleSpreadsheetWorksheet||"od6")+"/public/values?alt=json-in-script&callback=?",function(a){a=a.feed.entry;var c=a.length,l=0,q=0,k;for(k=0;k<c;k++){var p=
a[k];l=Math.max(l,p.gs$cell.col);q=Math.max(q,p.gs$cell.row)}for(k=0;k<l;k++)k>=g&&k<=m&&(e[k-g]=[],e[k-g].length=Math.min(q,f-d));for(k=0;k<c;k++)if(p=a[k],n=p.gs$cell.row-1,h=p.gs$cell.col-1,h>=g&&h<=m&&n>=d&&n<=f)e[h-g][n-d]=p.content.$t;b.dataFound()})},findHeaderRow:function(){m(this.columns,function(){});this.headerRow=0},trim:function(b){return"string"===typeof b?b.replace(/^\s+|\s+$/g,""):b},parseTypes:function(){for(var b=this.columns,a=b.length,c,e,d,f;a--;)for(c=b[a].length;c--;)e=b[a][c],
d=parseFloat(e),f=this.trim(e),f==d?(b[a][c]=d,31536E6<d?b[a].isDatetime=!0:b[a].isNumeric=!0):(e=this.parseDate(e),0!==a||"number"!==typeof e||isNaN(e)?b[a][c]=""===f?null:f:(b[a][c]=e,b[a].isDatetime=!0))},dateFormats:{"YYYY-mm-dd":{regex:"^([0-9]{4})-([0-9]{2})-([0-9]{2})$",parser:function(b){return Date.UTC(+b[1],b[2]-1,+b[3])}}},parseDate:function(b){var a=this.options.parseDate,c,e,d;a&&(c=a(b));if("string"===typeof b)for(e in this.dateFormats)a=this.dateFormats[e],(d=b.match(a.regex))&&(c=
a.parser(d));return c},rowsToColumns:function(b){var a,c;if(b){var e=[];var d=b.length;for(a=0;a<d;a++){var f=b[a].length;for(c=0;c<f;c++)e[c]||(e[c]=[]),e[c][a]=b[a][c]}}return e},parsed:function(){this.options.parsed&&this.options.parsed.call(this,this.columns)},complete:function(){var b=this.columns,a,c,e=this.options,d,f,l;if(e.complete){this.getColumnDistribution();1<b.length&&(a=b.shift(),0===this.headerRow&&a.shift(),a.isDatetime?c="datetime":a.isNumeric||(c="category"));for(d=0;d<b.length;d++)0===
this.headerRow&&(b[d].name=b[d].shift());var m=[];for(l=d=0;d<b.length;l++){var n=g.pick(this.valueCount.individual[l],this.valueCount.global);var h=[];for(f=0;f<b[d].length;f++)h[f]=[a[f],void 0!==b[d][f]?b[d][f]:null],1<n&&h[f].push(void 0!==b[d+1][f]?b[d+1][f]:null),2<n&&h[f].push(void 0!==b[d+2][f]?b[d+2][f]:null),3<n&&h[f].push(void 0!==b[d+3][f]?b[d+3][f]:null),4<n&&h[f].push(void 0!==b[d+4][f]?b[d+4][f]:null);m[l]={name:b[d].name,data:h};d+=n}e.complete({xAxis:{type:c},series:m})}}});g.Data=
r;g.data=function(b,a){return new r(b,a)};g.wrap(g.Chart.prototype,"init",function(b,a,c){var e=this;a&&a.data?g.data(g.extend(a.data,{complete:function(d){a.series&&m(a.series,function(b,c){a.series[c]=g.merge(b,d.series[c])});a=g.merge(d,a);b.call(e,a,c)}}),a):b.call(e,a,c)})})(Highcharts);
